<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maya‚Äôs Nexus</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap');
    
    /* MODIFIED: "overflow-x: hidden" has been removed to allow vertical page scrolling. */
    body { font-family: 'JetBrains Mono', monospace; background: #000; }

    /* All of your other styles are preserved exactly as they are. */
    .glass {
      backdrop-filter: blur(14px);
      background: linear-gradient(135deg, rgba(255,0,128,0.15), rgba(0,255,255,0.1));
      border: 1px solid rgba(255,255,255,0.1);
    }
    #backgroundGradient {
      background: radial-gradient(circle at 20% 20%, rgba(255,0,128,0.25), transparent 60%),
                  radial-gradient(circle at 80% 80%, rgba(0,255,255,0.25), transparent 60%),
                  #000;
      animation: pulse 6s infinite alternate;
    }
    @keyframes pulse { from { filter: brightness(0.8);} to { filter: brightness(1.2);} }
    .progress-bar { transition: width 1s ease-in-out; }
    .action-button:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(255,0,200,0.3); }
  </style>
</head>
<!-- MODIFIED: Removed "overflow-hidden" class and added data-character="maya" -->
<body class="min-h-screen bg-black relative" data-character="maya">

  <!-- Background (Unchanged) -->
  <div id="backgroundGradient" class="absolute inset-0"></div>

  <!-- Header (Unchanged) -->
  <div class="relative z-10 p-6 border-b border-pink-400/30">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold text-white mb-1 flex items-center">
          <span class="text-pink-400 mr-2">‚ô°</span> Maya‚Äôs Nexus
          <span class="text-xs ml-3 text-gray-400">swipe carefully...</span>
        </h1>
        <div class="text-sm text-gray-400">üîê Profile Security: <span id="profileSecurity">76%</span></div>
      </div>
      <div class="text-right">
        <div id="currentTime" class="text-sm text-gray-400">02:14 AM</div>
        <div class="text-xs text-pink-400">phishing attempts detected</div>
      </div>
    </div>
  </div>

  <!-- Resume Game Button removed - using main index.html button instead -->

  <!-- Layout (Unchanged) -->
  <div class="relative z-10 p-6 grid grid-cols-1 lg-grid-cols-3 gap-6">

    <!-- Main Panel (Unchanged) -->
    <div class="lg:col-span-2 space-y-6">

      <!-- Trust & Security (Unchanged) -->
      <div class="glass rounded-xl p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-xl font-bold text-white">Trust & Security</h2>
            <p id="trustStatus" class="text-lg font-semibold text-pink-400">INITIALIZING...</p>
          </div>
          <div class="text-right text-sm text-gray-300">
            <div>trust score: <span id="trustScore">--</span>%</div>
            <div>data leaks prevented: <span id="leaksPrevented">--</span></div>
          </div>
        </div>
        <div class="mb-6">
          <div class="flex justify-between text-sm mb-2">
            <span class="text-pink-300">dating app safety</span>
            <span id="trustPercent" class="text-white font-bold">--%</span>
          </div>
          <div class="relative h-6 bg-gray-800 rounded-full overflow-hidden">
            <div id="trustBar" class="h-full progress-bar bg-pink-500 shadow-pink-500/50 shadow-lg" style="width: 50%"></div>
          </div>
          <div class="flex justify-between text-xs mt-1 text-gray-500">
            <span>üíñ safe</span>
            <span>‚ö†Ô∏è suspicious</span>
            <span>üíî catfished</span>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <button id="backgroundCheckBtn" class="action-button glass text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center">
            üîç run background check
          </button>
          <button id="encryptBtn" class="action-button glass text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center">
            üîí encrypt messages
          </button>
        </div>
      </div>

      <!-- Maya's Guidance Chatbot (Unchanged) -->
      <div id="mayaGuidance" class="glass rounded-xl p-6">
        <h2 class="text-xl font-bold text-white mb-4">Maya's Guidance</h2>
        <div id="chatOutput" class="space-y-3 max-h-60 overflow-y-auto mb-4 border-t border-b border-pink-400/20 py-4">
            <!-- Messages are injected here by maya_pipeline.js -->
        </div>
        <div class="flex items-center space-x-3">
            <input type="text" id="mayaInput" class="flex-1 bg-gray-900/50 text-white placeholder-gray-400 p-3 rounded-lg border border-transparent focus:border-pink-400 focus:outline-none" placeholder="Type your choice...">
            <button id="mayaSendBtn" class="action-button bg-pink-600 text-white font-bold py-3 px-6 rounded-lg">Send</button>
        </div>
      </div>

      <!-- Notifications Area (Unchanged) -->
      <div id="notificationsArea" class="space-y-3"></div>
      
    </div>

    <!-- Side Panel (Unchanged) -->
    <div class="space-y-6">
        <div class="glass rounded-xl p-5"><!-- ... --></div>
        <div class="glass rounded-xl p-5"><!-- ... --></div>
        <div class="glass rounded-xl p-5"><!-- ... --></div>
    </div>
  </div>

  <!-- This script loads the logic for the main dashboard. It is preserved. -->
  <script src="../Game/Mechanics/maya_pipeline.js"></script>

  <!-- ‚úÖ THIS IS THE ONLY NEW LINE OF CODE. It injects the pop-up Chroma Bot. -->
  <script src="../Game/Mechanics/chroma_bot_injectors.js"></script>

  <!-- This inline script connects the main dashboard UI to its pipeline. It is preserved. -->
  <script>
    // --- UI Element References ---
    const trustBar = document.getElementById("trustBar");
    const trustPercent = document.getElementById("trustPercent");
    const trustStatus = document.getElementById("trustStatus");
    const trustScoreDisplay = document.getElementById("trustScore");
    const notificationsArea = document.getElementById("notificationsArea");
    const leaksPreventedDisplay = document.getElementById("leaksPrevented");

    /**
     * Master function to update the entire dashboard based on data from the backend.
     */
    function updateDashboardUI(data) {
      if (!data || typeof data.trust_score === 'undefined') {
        console.error("Invalid data received for UI update:", data);
        return;
      }
      const score = data.trust_score;
      const percentage = (score + 100) / 2;
      trustPercent.textContent = Math.round(percentage) + "%";
      trustScoreDisplay.textContent = Math.round(percentage);
      trustBar.style.width = percentage + "%";
      if (data.persona === 'Guardian') {
        trustStatus.textContent = "SECURE";
        trustStatus.className = "text-lg font-semibold text-green-400";
        trustBar.className = "h-full progress-bar bg-green-500 shadow-green-500/50 shadow-lg";
      } else {
        if (percentage > 40) {
            trustStatus.textContent = "VULNERABLE";
            trustStatus.className = "text-lg font-semibold text-yellow-400";
            trustBar.className = "h-full progress-bar bg-yellow-500 shadow-yellow-500/50 shadow-lg";
        } else {
            trustStatus.textContent = "AT RISK";
            trustStatus.className = "text-lg font-semibold text-red-400";
            trustBar.className = "h-full progress-bar bg-red-500 shadow-red-500/50 shadow-lg";
        }
      }
      if (data.red_flags && data.red_flags.length > 0) {
        data.red_flags.forEach(flag => showNotification("Red Flag Detected!", flag, 'üö®'));
      }
    }

    /**
     * Function to show a temporary notification.
     */
    function showNotification(title, subtitle, icon) {
      const div = document.createElement("div");
      div.className = `glass notification border-l-4 border-pink-400 rounded-r-lg p-4 mb-3`;
      div.innerHTML = `<div class="flex items-center"><span class="text-2xl mr-3">${icon}</span><div><div class="font-bold text-white">${title}</div><div class="text-sm text-gray-300">${subtitle}</div></div></div>`;
      notificationsArea.insertBefore(div, notificationsArea.firstChild);
      setTimeout(() => { div.style.opacity = "0"; setTimeout(() => div.remove(), 500); }, 5000);
    }
    
    // --- Event Listeners for UI actions ---
    document.getElementById("backgroundCheckBtn").addEventListener("click", async () => {
      const newState = await sendChoice("Run a background check");
      showNotification("Action Taken", "Running background check on suspicious profiles...", "üîç");
      updateDashboardUI(newState);
    });

    document.getElementById("encryptBtn").addEventListener("click", async () => {
      const newState = await sendChoice("Encrypt my messages");
      showNotification("Action Taken", "Activating end-to-end encryption...", "üîí");
      updateDashboardUI(newState);
    });

    // --- Ambient, non-backend related UI updates (Kept from original) ---
    function updateTime() {
      document.getElementById("currentTime").textContent = new Date().toLocaleTimeString("en-US", {hour12:false, hour:"2-digit", minute:"2-digit"});
    }
    function updateMusicProgress() {
      const musicProgress = document.getElementById("musicProgress");
      if (musicProgress) {
        let progress = parseFloat(musicProgress.style.width) || 0;
        musicProgress.style.width = ((progress + 0.5) % 100) + "%";
      }
    }

    // --- Start everything when the page loads ---
    document.addEventListener('DOMContentLoaded', async () => {
      const initialState = await sendChoice("Maya has logged into the Nexus.");
      updateDashboardUI(initialState);
      updateTime();
      setInterval(updateTime, 1000);
      setInterval(updateMusicProgress, 2000);

      // --- Resume Game Button Functionality ---
      const resumeGameBtn = document.getElementById('maya-resume-game-btn');
      if (resumeGameBtn) {
        console.log('‚úÖ Maya Resume Game button found and event listener added');
        resumeGameBtn.addEventListener('click', () => {
          console.log('üéÆ Maya Resume Game button clicked - sending message to parent');
          // Send message to parent window to trigger game view
          window.parent.postMessage({ action: 'resume-game', character: 'maya' }, '*');
        });
      } else {
        console.error('‚ùå Maya Resume Game button not found!');
      }
    });
  </script>

</body>
</html>